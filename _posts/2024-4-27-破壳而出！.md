---
layout:     post
title:      KVOè¯¦è§£
subtitle:   KVOåº•å±‚åŸç†åŠå…¶å®ç°
date:       2021-03-29
author:     BY
header-img: img/post-bg-cook.jpg
catalog: true
tags:
    
---

## å‰è¨€

è¿™é‡Œæ˜¯å‰è¨€



## æ­£æ–‡

`è¿™é‡Œæ˜¯æ­£æ–‡ `


### 1

- æˆ‘

```	æˆ‘
- æˆ‘çš„
```


- ğŸ˜«


ä»£ç æ¼”ç¤º

```objc
- printf("Hello World!")
```

è¾“å‡º

```
Hello World!
```


### 2




```objc
???
```


```
 ????????????????
```

#### æˆ‘ä»¬æ¥çœ‹çœ‹é‡å†™çš„`set`æ–¹æ³•åšäº†ä»€ä¹ˆã€‚
111

#### åˆ°æ­¤æ•´ä¸ª`KVO`æµç¨‹åŸºæœ¬ä¸Šå°±æ¸…æ™°äº†ï¼š


![](https://baidu.com)



### åŠ¨æ€ç”Ÿæˆä¸€ä¸ªè‡ªå·±çš„ç±»






### è‡ªå·±å†™ä¸€ä¸ªKVO


> ä¸‹é¢ä»£ç è¿è¡Œä¼šæŠ¥é”™ åœ¨ `Build Settings` ä¸­è®¾ç½®`ENABLE_STRICT_OBJC_MSGSEND = NO`å³å¯


#pragma mark - é‡å†™çˆ¶ç±»æ–¹æ³•

void setName(id self, SEL _cmd, NSString *name) {
    
    // ä¿å­˜å½“å‰KVOçš„ç±»
    Class kvoClass = [self class];
    
    // å°†selfçš„isaæŒ‡é’ˆæŒ‡å‘çˆ¶ç±»BYPersonModelï¼Œè°ƒç”¨çˆ¶ç±»setteræ–¹æ³•
    object_setClass(self, class_getSuperclass([self class]));
    objc_msgSend(self, @selector(setName:), name);
    
    // è·å–BY_NSKVONotifying_BYPrsonModelè§‚å¯Ÿè€…
    id objc = objc_getAssociatedObject(self, (__bridge const void *)@"observer");
    // é€šçŸ¥è§‚å¯Ÿè€…ï¼Œæ‰§è¡Œé€šçŸ¥æ–¹æ³•
    NSDictionary<NSKeyValueChangeKey,id> *change = @{@"kind": @1, @"new": name};
    objc_msgSend(objc, @selector(observeValueForKeyPath:ofObject:change:context:), @"name", self, change, nil);
    
    // å°†æŒ‡é’ˆé‡æ–°æŒ‡å‘ BY_NSKVONotifying_BYPrsonModel
    object_setClass(self, kvoClass);
}


@end




### å‚è€ƒ
- [ã€ŠIntroduction to Key-Value Observing Programming Guideã€‹
](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html#//apple_ref/doc/uid/10000177-BCICJDHA)
- https://blog.csdn.net/science_lee/article/details/82843080
- https://www.cenzhijun.top/2018/05/kvo/
